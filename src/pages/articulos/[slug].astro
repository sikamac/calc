---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('articulos');
  return blogEntries.map(entry => ({
    params: { slug: entry.id.replace(/\.md$/, '') },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

const title = `${entry.data.title} | GIST POINT`;
const description = entry.data.description;

const allArticles = await getCollection('articulos');
const relatedArticles = allArticles
  .filter(a => a.id !== entry.id)
  .slice(0, 2);
---

<BaseLayout 
  title={title}
  description={description}
  url={Astro.url.href}
  image={entry.data.image}
  type="article"
>
  <Header />
  <main class="py-8 lg:py-12 bg-gray-50">
    <article class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="lg:grid lg:grid-cols-12 lg:gap-12">
        
        <div class="lg:col-span-8">
          <article class="bg-white rounded-2xl shadow-sm overflow-hidden">
            <header class="p-6 lg:p-10 border-b border-gray-100">
              <div class="flex flex-wrap items-center gap-3 mb-4">
                <span class="px-3 py-1 bg-accent/10 text-accent text-sm font-semibold rounded-full">
                  {entry.data.category}
                </span>
                <time class="text-gray-500 text-sm">
                  {new Date(entry.data.date).toLocaleDateString('es-AR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </time>
              </div>
              
              <h1 class="text-3xl lg:text-4xl font-bold text-primary mb-4 leading-tight">
                {entry.data.title}
              </h1>
              
              <p class="text-lg text-gray-600 mb-6">
                {entry.data.description}
              </p>
              
              <div class="flex flex-wrap items-center gap-3">
                <div class="flex items-center gap-2">
                  <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-sm font-bold">
                    GP
                  </div>
                  <span class="text-sm font-medium text-gray-700">{entry.data.author}</span>
                </div>
                
                <div class="flex items-center gap-2 ml-auto">
                  {entry.data.tags.slice(0, 3).map((tag: string) => (
                    <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-md font-medium">
                      #{tag}
                    </span>
                  ))}
                </div>
              </div>
            </header>

            <div class="p-6 lg:p-10">
              <div class="prose prose-lg max-w-none">
                <Content />
              </div>
            </div>
          </article>

          <div class="mt-8 bg-primary text-white rounded-2xl p-8 text-center">
            <h2 class="text-2xl font-bold mb-4">
              쯅ecesit치s ayuda con tu importaci칩n?
            </h2>
            <p class="text-blue-100 mb-6 max-w-2xl mx-auto">
              Nuestro equipo de expertos de GIST POINT puede ayudarte con dudas espec칤ficas 
              sobre tu operaci칩n de importaci칩n.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
              <a href="/calculadora" class="btn bg-accent hover:bg-orange-600 text-white px-6 py-3 rounded-xl font-semibold">
                Usar Calculadora
              </a>
              <a href="/contacto" class="btn bg-white text-primary hover:bg-gray-100 px-6 py-3 rounded-xl font-semibold">
                Contactar Experto
              </a>
            </div>
          </div>
        </div>

        <aside class="lg:col-span-4 mt-8 lg:mt-0">
          <div class="sticky top-24 space-y-6">
            <div class="bg-white rounded-2xl shadow-sm p-6">
              <h3 class="text-lg font-bold text-primary mb-4">Sobre este art칤culo</h3>
              <dl class="space-y-3 text-sm">
                <div class="flex justify-between">
                  <dt class="text-gray-500">Categor칤a</dt>
                  <dd class="font-medium text-gray-900">{entry.data.category}</dd>
                </div>
                <div class="flex justify-between">
                  <dt class="text-gray-500">Autor</dt>
                  <dd class="font-medium text-gray-900">{entry.data.author}</dd>
                </div>
                <div class="flex justify-between">
                  <dt class="text-gray-500">Publicado</dt>
                  <dd class="font-medium text-gray-900">
                    {new Date(entry.data.date).toLocaleDateString('es-AR', {
                      day: 'numeric',
                      month: 'short',
                      year: 'numeric'
                    })}
                  </dd>
                </div>
              </dl>
            </div>

            <div class="bg-white rounded-2xl shadow-sm p-6">
              <h3 class="text-lg font-bold text-primary mb-4">Herramientas</h3>
              <div class="space-y-3">
                <a 
                  href="/calculadora" 
                  class="flex items-center gap-3 p-3 rounded-xl bg-gray-50 hover:bg-accent/10 transition-colors group"
                >
                  <span class="text-2xl">游빑</span>
                  <div>
                    <div class="font-medium text-gray-900 group-hover:text-accent">Calculadora</div>
                    <div class="text-xs text-gray-500">Calcular costos</div>
                  </div>
                </a>
                <a 
                  href="/contacto" 
                  class="flex items-center gap-3 p-3 rounded-xl bg-gray-50 hover:bg-accent/10 transition-colors group"
                >
                  <span class="text-2xl">游닎</span>
                  <div>
                    <div class="font-medium text-gray-900 group-hover:text-accent">Consultar</div>
                    <div class="text-xs text-gray-500">Asesoramiento experto</div>
                  </div>
                </a>
              </div>
            </div>

            {relatedArticles.length > 0 && (
              <div class="bg-white rounded-2xl shadow-sm p-6">
                <h3 class="text-lg font-bold text-primary mb-4">M치s art칤culos</h3>
                <div class="space-y-4">
                  {relatedArticles.map((article) => (
                    <a 
                      href={`/articulos/${article.id.replace(/\.md$/, '')}`}
                      class="block p-3 rounded-xl hover:bg-gray-50 transition-colors"
                    >
                      <div class="text-xs text-accent font-medium mb-1">{article.data.category}</div>
                      <div class="font-medium text-gray-900 text-sm line-clamp-2">{article.data.title}</div>
                    </a>
                  ))}
                </div>
              </div>
            )}
          </div>
        </aside>
      </div>
    </article>
  </main>
  <Footer />
</BaseLayout>
